{
    "resourceType": "ServiceRequest",
    "locationCode": "amaqHI7PUL2",
    "locationReference": "Baba Yaga HC III",
    "code": "VL-1", 
    "note": "UgandaEMR", 
    "performerType": "????", 
    "status": "active", 
    "intent": "order", 
    "subject": {
        "resourceType": "TestRequest",
        "identifier": "uYhaike0003"//test request id generated by the EMR
    },
    "patient":{
        "resourceType": "Patient",
        "identifier":"",//
        "name":"",
        "birthDate":"yyyy-mm-dd",
        "gender":"",//male, female
        "telephone":""

    },
    "clinicalNotes":{
        "resourceType": "ClinicalNotes",
        "text": "",
        "hasPatientBeenHospitalizedForMoreThan48Hours":"",//yes,no
        "hasPatientBeenOnAntibioticsDuringTheInfection":"",//yes,no
        "previousTherapy":"",
        "currentTherapy":""
    },
    "requester": {
        "resourceType": "Practitioner",
        "name": "F. Asissi",
        "telecom": "0774216355",
        "email":"",
        "cadre":""//BS Nursing, MbChB,
    }
}


==== valid json example ======
{
    "resourceType": "ServiceRequest",
    "locationCode": "HXap310Pwnz",
    "locationReference": "Rukunyu Hospital",
    "code": "VL-1", 
    "note": "UgandaEMR", 
    "performerType": "????", 
    "status": "active", 
    "intent": "order", 
    "subject": {
        "resourceType": "TestRequest",
        "identifier": "RKY-2020092401"
    },
    "patient":{
        "resourceType": "Patient",
        "identifier": "ART092",
        "name": "Muhembo Jeninah",
        "birthDate":"1990-09-01",
        "gender":"female",
        "telephone":"079899862"

    },
    "clinicalNotes":{
        "resourceType": "ClinicalNotes",
        "text": "Do a blood slide for Malaria and Pregancy Test",
        "hasPatientBeenHospitalizedForMoreThan48Hours": "no",
        "hasPatientBeenOnAntibioticsDuringTheInfection": "no",
        "previousTherapy": "no",
        "currentTherapy": "no"
    },
    "requester": {
        "resourceType": "Practitioner",
        "name": "Dr. F. Asissi",
        "telecom": "0774216355",
        "email": "Asissi@rukunyu.go.ug",
        "cadre": "Mmed"
    }
}
=== request in JSON using curl ===
curl --header "Content-Type: application/json" --request POST --data '{
    "resourceType": "ServiceRequest",
    "locationCode": "HXap310Pwnz",
    "locationReference": "Rukunyu Hospital",
    "code": "VL-1", 
    "note": "UgandaEMR", 
    "performerType": "????", 
    "status": "active", 
    "intent": "order", 
    "subject": {
        "resourceType": "TestRequest",
        "identifier": "RKY-2020092401",
        "visit_type": "in-patient",
        "ward": "",
        "bedNumber" : ""
    },
    "patient":{
        "resourceType": "Patient",
        "identifier": "ART092",
        "name": "Muhembo Jeninah",
        "birthDate":"1990-09-01",
        "gender":"female",
        "telephone":"079899862"

    },
    "clinicalNotes":{
        "resourceType": "ClinicalNotes",
        "text": "Do a blood slide for Malaria and Pregancy Test",
        "hasPatientBeenHospitalizedForMoreThan48Hours": "no",
        "hasPatientBeenOnAntibioticsDuringTheInfection": "no",
        "previousTherapy": "no",
        "currentTherapy": "no"
    },
    "requester": {
        "resourceType": "Practitioner",
        "identifier": "DRFASSSI",
        "name": "Dr. F. Asissi",
        "telecom": "0774216355",
        "email": "Asissi@rukunyu.go.ug",
        "cadre": "Mmed"
    }
}' http://localhost:8093/api/fhir/emr_test_request 



==================
/*
private function generatePatient($received_test_request){
        
        $patient = null;
        $received_patient_array = $received_test_request['patient'];
        
        $patient = UnhlsPatient::where('patient_number', '=', $received_patient_array['identifier']);
        \Log::info('..testing patient ..');
        var_dump($patient);
        if($patient == null){
            $patient = new UnhlsPatient();
            $patient->patient_number = $received_patient_array['identifier'];
            $patient->name = $received_patient_array['name'];
            $patient->gender = ($received_patient_array['gender'] == 'female') ? 1  : 0;
            $patient->dob = $received_patient_array['birthDate'];
            $patient->phone_number = $received_patient_array['telephone'];
            $patient->created_by = 1;
            $patient->save();
            
            $patient->ulin = $patient->getUlin();
            $patient->save();

            $uuid = new UuidGenerator(); 
            $uuid->save();
        }else{
            \Log::info('Patient exists');
            \Log::info($patient);
        }
        

        return $patient;
    }

    private function generateClinician($received_test_request){
        $clinician = null;
        $received_clinician_array = $received_test_request['requester'];

        $clinician = Clinician::where('unique_number', '=', $received_clinician_array['identifier']);
        \Log::info('..testing clinician ..');
        var_dump($clinician);
        if($clinician == null){
            $clinician = new Clinician();
            
            $clinician->unique_number = $received_clinician_array['identifier'];
            $clinician->cadre = $received_clinician_array['cadre'];
            $clinician->phone = $received_clinician_array['telecom'];
            $clinician->email = $received_clinician_array['email'];
            $clinician->save();
        }else{
            \Log::info('clinician exists');
            \Log::info($clinician);
        }
        return $clinician;
    }
    public function emrTestRequest(){
        $received_test_request = \Input::all();

        $status="";
        $status_code =0;
        $status_message = "";

        //Patient Bio
        $patient = $this->generatePatient($received_test_request);
        
        //Clinician
        $clinician = $this->generateClinician($received_test_request);

        //Clinical Notes
        $received_clinical_notes_array = $received_test_request['clinicalNotes'];


        $received_subject = $received_test_request['subject'];

        $emr_test_request_instance = null;
        $emr_test_request_instance = EmrTestRequest::where('emr_request_id', '=', $received_subject['identifier']);

        if($emr_test_request_instance == null){
            $emr_test_request_instance = new EmrTestRequest();
            $emr_test_request_instance->patient_id = $patient->id;
            $emr_test_request_instance->clinician_id = $clinician->id;

            
            $emr_test_request_instance->clinical_notes = $received_clinical_notes_array['text'];
            $emr_test_request_instance->hospitalised_more_than_24hrs = $received_clinical_notes_array['hasPatientBeenHospitalizedForMoreThan48Hours'];
            $emr_test_request_instance->been_on_anti_biotics = $received_clinical_notes_array['hasPatientBeenOnAntibioticsDuringTheInfection'];
            $emr_test_request_instance->current_therapy = $received_clinical_notes_array['currentTherapy'];
            $emr_test_request_instance->previous_therapy = $received_clinical_notes_array['previousTherapy'];

            //Location
            $received_subject = $received_test_request['subject'];
            $emr_test_request_instance->emr = $received_test_request['note'];
            $emr_test_request_instance->ward = $received_subject['ward'];
            $emr_test_request_instance->bed_number = $received_subject['bedNumber'];
            $emr_test_request_instance->emr_request_id = $received_subject['identifier'];
            $emr_test_request_instance->visit_type_id = ($received_subject['visit_type'] == 'in-patient')?1:2;
        
            //store transaction from EMR
            $emr_test_request_instance->save();

            $status="success";
            $status_code =201;
            $status_message = "Test Request received successfully in the Laboratory";
        }else{
            $status="error";
            $status_code =409;
            $status_message = "Conflict: Record already exists by id.";
        }
        
        return \Response::json(['status' => $status, 'message' => $status_message], $status_code);
    }
    */